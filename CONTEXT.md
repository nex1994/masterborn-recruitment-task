# ConfigureFlow - Business Context

## Company Overview

**ConfigureFlow** is a B2B SaaS company that provides embeddable product configuration widgets for e-commerce platforms. Our customers are typically mid-to-large retailers who sell customizable products.

### Our Customers

- **TechStyle** - Consumer electronics retailer (custom laptops, phones)
- **CustomPrint Co** - Personalized merchandise (t-shirts, mugs, posters)
- **FurnishNow** - Configurable furniture (sofas, desks with multiple options)
- **GiftBox Pro** - Corporate gift packages

### The Product

The `ProductConfigurator` is our core widget. It's embedded via iframe or direct integration into customer websites. End-users (shoppers) use it to:

1. Select product options (size, color, material, etc.)
2. See real-time price updates based on selections
3. Preview their configured product
4. Save draft configurations
5. Share configurations via URL
6. Add configured products to cart

## Key Terminology

### Configuration
A specific combination of selected options for a product. Each configuration has a unique identifier and can be saved/shared.

### Options
Product attributes that can be selected. Types include:
- **Single Select** - Dropdown (e.g., Size: S/M/L/XL)
- **Color** - Color picker with predefined swatches
- **Quantity** - Numeric input with min/max limits
- **Add-ons** - Checkboxes for optional features
- **Toggles** - Boolean flags (e.g., "Include Packaging")

### Option Dependencies
Some options depend on others:
- "Gift Wrap" add-on requires "Include Packaging" to be enabled
- "Premium Engraving" only available for "Metal" material
- Some colors not available in all sizes

### Pricing Rules

Prices are calculated server-side (mocked in this repo) based on:

1. **Base Price** - Starting price for the product
2. **Option Modifiers** - Each option selection may add/subtract from price
3. **Quantity Discounts** - Tiered pricing at certain quantities
   - 1-9 items: No discount
   - 10-49 items: 5% off
   - 50+ items: 10% off
4. **Add-on Costs** - Fixed costs for additional features

### Draft System

Users can save incomplete configurations as "drafts" to return to later. Drafts are stored in localStorage with:
- Configuration ID
- All selected options
- Timestamp
- User-provided name (optional)

### Share URLs

Configurations can be shared via URL. The URL contains encoded configuration data that recreates the exact state when opened.

## Architecture Notes

### The Component Structure

The `ProductConfigurator` component is intentionally monolithicâ€”this is a legacy decision that Marcus (previous dev) made for "simplicity." In practice, it probably should be broken into smaller components, but that's a larger refactor for another time.

### State Management

All state is managed within the component using `useState` hooks. There's no external state management (Redux, Zustand, etc.). This was a deliberate choice to keep the widget self-contained and easy to embed.

### API Interactions

All API calls are mocked in `services/api.ts`. In production, these would hit our actual backend:

- `calculatePrice(config)` - Returns calculated price (async, ~200-500ms)
- `validateConfiguration(config)` - Checks for conflicts (async)
- `generatePreview(config)` - Returns preview image URL (async, ~100-300ms)
- `saveDraft(config)` - Persists to localStorage (sync, but wrapped in Promise)
- `loadDraft(id)` - Retrieves from localStorage

### Preview Images

Preview images are generated by combining base product images with overlays for each option. This is simulated in the mock API. The actual logic for image composition isn't relevant to this task.

## Known Technical Debt

Marcus left some notes before he departed:

> "The price calculation hook is a bit janky. I meant to refactor it but never got around to it. There might be some timing issues if users click fast. Also, I'm not 100% sure the resize handler cleanup is working right."

> "The option validation logic is complicated because of all the dependencies. I added a bunch of defensive null checks. Some might be unnecessary but I didn't want to risk breaking anything."

> "The Quick Add feature was a rush job for a customer demo. It works but the code is rough."

## Client Demo Context

TechStyle is our biggest prospect. They're evaluating ConfigureFlow for their custom laptop builder. The demo is in 2 weeks.

Key things they care about:
1. **Reliability** - No crashes, accurate pricing
2. **Performance** - Their users configure complex products
3. **Accessibility** - They have compliance requirements (WCAG 2.1 AA)
4. **UX Polish** - They're a premium brand

## Questions You Might Have

### Why is this component so big?

Historical reasons. Marcus believed in "keeping things together that change together." The plan was always to break it up eventually.

### Why localStorage for drafts?

Our target embedding scenarios don't always allow cookies/sessions. localStorage was the most reliable cross-domain option.

### Why async price calculation for what seems like simple math?

In production, pricing involves complex rules, promotions, and inventory checks that require server-side logic. Even though it's mocked here, we want to preserve the async pattern.

### What's the deal with the "47" in some error codes?

Inside joke from an old bug. The number isn't meaningful.
